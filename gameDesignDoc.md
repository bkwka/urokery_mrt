```markdown
# Game Design Document (GDD)
Игра: "Таблица умножения — Межпланетный Рыцарский Турнир" (версия 0.5 → базовая коммерческая версия)

Дата: 2025-10-24  
Автор: Максим Демин & Copilot  
Версия документа: 1.5

Changelog
- 2025-10-22 v1.0 — исходный документ (Максим Демин & Copilot).
- 2025-10-22 v1.1 — обновление: регистрация обязательна для сохранения прогресса; все уровни бесплатны на данном этапе; монеты выдаются только за решение примеров (без IAP на данном этапе); HP игрока зависит от выбранного героя. (обновил Copilot по запросу raagoonshinaah)
- 2025-10-24 v1.2 — изменение механики таймера: таймер теперь привязан не ко всему монстру, а к каждому отдельному примеру. На каждом примере показывается таймер 5 секунд; если игрок не успевает ответить — с него снимается 1 HP. (обновление по запросу bkwka)
- 2025-10-24 v1.3 — изменение структуры уровней: теперь уровни сгруппированы в 6 этапов по 5 уровней. Каждый новый этап сопровождается экраном-интро с информацией об этапе и кнопкой "Начать". (обновление по запросу bkwka)
- 2025-10-24 v1.4 — добавлена пауза перед каждым новым раундом: перед появлением нового монстра/раунда показывается экран-пауза с кнопкой "Дальше". (обновление по запросу bkwka)
- 2025-10-24 v1.5 — добавлен раздел "Планеты" и экран PlanetsPage: страница выбора планеты, подробности планеты и пул монстров; на странице показываются только уже побеждённые монстры, неподобённые отображаются как пустые слоты/placeholder. (обновление по запросу bkwka)

---

Оглавление
1. Краткое описание проекта  
2. Цели и аудитория  
3. Геймплей и «core loop»  
4. Механики и правила  
5. Прогрессия уровней и генерация задач  
6. Монстры, герои и предметы  
7. Баланс HP и таймеров  
8. Монетизация и модель оплаты (текущий статус)  
9. Интерфейс / UX / экраны  
10. Туториал и онбоардинг  
11. Магазин / внутриигровая валюта / покупки за монеты  
12. Сценарии проигрыша и продолжения  
13. Арт- и аудиоспецификации  
14. Технические требования и архитектура  
15. Данные, API и модели данных  
16. Тестирование, аналитика и метрики  
17. План разработки и вехи (milestones)  
18. Acceptance criteria / Критерии приемки  
19. Риски и меры по их снижению  
20. Приложения: примеры экранов и конфигурации  
21. Планеты (новый раздел)

---

[Секции 1–20 — без изменений по содержанию (см. v1.4)]

9. Интерфейс / UX / экраны
(добавлено)
- PlanetsPage: отдельный экран/меню выбора планет (см. раздел 21). Должен быть доступен из MainMenu и из ProgressPage / HeroSelect (опционально). При выборе планеты основной экран (детали) обновляется.

15. Данные, API и модели данных
(дополнения для планет)
- Planet model (новое):
  - { id, key, name, description, banner, image, monsters: [monsterId...], unlockedMonsterIds: [monsterId...], discoveredAt }
- Level / Monster config: добавить поле originPlanetId
- Recommended new endpoints:
  - GET /api/planets -> список планет (metadata)
  - GET /api/planets/{planetId} -> данные планеты + список монстров (указываются все монстры, но client-side фильтрует отображение по defeated/unlocked)
  - POST /api/user/planet-visit -> (analytics: отметка посещения пользователем)
- Client-side should store which monsters are defeated to decide visibility on PlanetsPage. If server exists, sync defeated list: POST /api/user/defeated-monster

16. Тестирование, аналитика и метрики
(дополнить)
- Новые события:
  - planet_list_viewed
  - planet_selected (planetId)
  - planet_monster_slot_viewed (planetId, monsterId, slotIndex)
  - planet_monster_revealed (when monster is defeated and becomes visible on PlanetsPage)

20. Приложения: примеры экранов и конфигурации
(добавлено пример planet config)
```json
{
  "id": "planet_03",
  "key": "asteroid_belt",
  "name": "Пояс Астероидов",
  "description": "Суровая арена, где монстры привыкли к быстрым атакам и высоким множителям.",
  "banner": "assets/ui/planets/planet_03_banner.png",
  "image": "assets/ui/planets/planet_03_image.png",
  "monsters": [
    "monstr_09",
    "monstr_10",
    "monstr_11",
    "monstr_12",
    "monstr_13"
  ],
  "unlockedMonsterIds": [
    "monstr_09",
    "monstr_11"
  ]
}
```

21. Планеты (новый раздел)
Цель раздела
- Ввести лор/контекст для монстров и усилить мотивацию игрока через коллекционирование — показывать планеты, откуда прилетают монстры, их описание и визуальную карту «кто ещё остаётся непобеждённым».

Функционал PlanetsPage
- Меню выбора планет:
  - Список доступных планет (иконка + краткий текст).
  - При наведении/выборе — краткая подсказка об этой планете.
- Экран деталей планеты:
  - Основной баннер/изображение планеты (large).
  - Описание планеты (1–3 предложения).
  - Сетка слотов с монстрами, которые связаны с этой планетой (расположены в поле monsters в конфиге).
    - Для каждого слота:
      - Если монстр побеждён (defeated / included в user.unlocked/defeated list) — показывать PNG монстра, имя, краткую статистику (HP, special hints).
      - Если монстр ещё не побеждён — показывать пустой placeholder (silhouette? пустая рамка) и подпись "Неизвестный монстр".
  - Кнопка "Назад" и кнопка/действие для "Перейти к битве" (если хотите начать уровень/раунд с монстром сразу — опционально).
- Поведение при нажатии на слоты:
  - Если монстр доступен (побеждён) — открывать карточку монстра (modal) с подробной информацией и ссылкой на связанные уровни/повторный бой.
  - Если монстр ещё не побеждён — показать подсказку "Победи этого монстра в его уровне, чтобы разблокировать".
- Состояния:
  - Пустые слоты — визуально различимы.
  - Если пользователь ещё не зарегистрирован — показывать подсказку о регистрации, чтобы сохранить коллекцию.

Требования к данным и синхронизации
- Клиент получает список планет и монстров через API / локальный конфиг.
- Видимость монстров определяется по user.defeatedMonsters (localStorage или сервер).
- При победе над монстром устанавливать флаг defeated и синхронизировать с сервером (если подключен).

UX / дизайн-заметки
- PlanetsPage — место для небольших историй/наград. Можно давать за посещение планеты небольшую подсказку или 1 монету (опционально).
- Placeholder для непобеждённых монстров должен стимулировать интерес — силуэт, вопросительный знак и короткий текст "Победи, чтобы узнать".
- Кнопка "Перейти к битве" может вести на соответствующий уровень (если требуется), либо на StageIntro/LevelSelect внутри этапа.

Архитектурные замечания и конфиг
- Добавить каталог ассетов: public/assets/planets/*.png
- Планетный конфиг (stages can reference planetId or planets can list monsters that map to levels)
- При генерации уровней/монстров указывать originPlanetId для взаимной связи.

Примерный UI flow
- MainMenu -> PlanetsPage (grid of planets) -> select Planet -> PlanetDetail (banner + monsters grid) -> click monster slot -> (modal or navigate to LevelSelect/StageIntro)

Аналитика
- События для отслеживания вовлечённости:
  - planet_list_viewed
  - planet_selected
  - planet_monster_slot_clicked
  - planet_monster_revealed (on first reveal after defeating monster)

---

Что сделано сейчас
- Добавлен новый раздел "Планеты" в GDD (v1.5).
- Обновлены оглавление, разделы UI, Data/API, аналитика и приложения (примеры конфигов и assets).
- Четко описано поведение PlanetsPage: меню планет, детальный экран, логика отображения монстров (только побеждённые видимы; непобеждённые — placeholder), синхронизация defeated-флагов и аналитика.

Дальше (рекомендации / варианты действий)
- Я могу:
  1) Разбить изменения, связанные с PlanetsPage, на actionable issues (backlog) с приоритизацией и оценками;  
  2) Подготовить skeleton страницы PlanetsPage (HTML/CSS/JS) и пример client-side логики фильтрации побеждённых монстров (исправлю game.js/SPA компоненты);  
  3) Сгенерировать пример данных/JSON для всех планет и скелет конфигов и положить в public/assets/planets/ и src/data/ (mock).  

Выберите один из вариантов (1, 2 или 3) — я сразу выполню выбранный шаг и пришлю файлы/issue-list/патч в следующем сообщении.
```
```
